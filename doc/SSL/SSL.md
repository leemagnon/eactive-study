# SSL/TLS

## 1. SSLμ΄λ€?
SSL (Secure Sockets Layer) μ€ ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„ κ°„μ λ°μ΄ν„° μ•”νΈν™” ν†µμ‹ μ„ κ°€λ¥ν•κ² ν•λ” ν”„λ΅ν† μ½μ…λ‹λ‹¤.
ν„μ¬λ” TLSκ°€ ν‘μ¤€μ΄μ§€λ§, κ΄€μµμ μΌλ΅ SSLμ΄λΌλ” ν‘ν„μ„ λ§μ΄ μ”λ‹λ‹¤.

---

## 2. SSL μ‘λ™ μ›λ¦¬

![Simplified SSL Protocol](./images/ssl-simplified.png)

- **Alice** : μ›Ήμ‚¬μ΄νΈμ— μ ‘μ†ν•λ ¤λ” μ‚¬μ©μ (ν΄λΌμ΄μ–ΈνΈ)
- **Bob** : μ›Ήμ‚¬μ΄νΈ μ„λ²„ (μΈμ¦μ„λ¥Ό κ°€μ§€κ³  μμ)
- **CA (Certificate Authority)** : μΈμ¦μ„λ¥Ό λ°κΈ‰ν•΄μ£Όλ” μ‹ λΆ°λ κΈ°κ΄€ (μ: DigiCert, Let's Encrypt λ“±)

1. ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ— μ ‘μ† (Client Hello)
2. μ„λ²„κ°€ μΈμ¦μ„(Certificate)λ¥Ό μ „λ‹¬ (Server Hello)
3. ν΄λΌμ΄μ–ΈνΈκ°€ κ³µκ°ν‚¤λ΅ pre-master secret(S) μ•”νΈν™” ν›„ μ „μ†΅
4. μ„λ²„κ°€ λΉ„λ°€ν‚¤λ΅ λ³µνΈν™”
5. μ„λ΅ S, RA, RBλ΅ μ„Έμ… ν‚¤(K) μƒμ„±
6. μ΄ν›„λ¶€ν„°λ” μ„Έμ… ν‚¤(K)λ΅ λ°μ΄ν„° μ•”νΈν™” ν†µμ‹ 

μ΄λ¬ν• κ³Όμ •μ„ **SSL/TLS ν•Έλ“μ…°μ΄ν¬**λΌκ³  ν•©λ‹λ‹¤.

---

## 1λ‹¨κ³„ : μ„λ²„ μΈμ¦μ„ μ¤€λΉ„ (μ„λ²„ μΈ΅ μ‘μ—…)

1. Bob(μ„λ²„)μ€ μμ‹ μ **κ³µκ°ν‚¤(Public Key)** μ™€ **λΉ„λ°€ν‚¤(Private Key)** λ¥Ό μƒμ„±ν•©λ‹λ‹¤.
2. λ„λ©”μΈ μ •λ³΄, μ΅°μ§ μ •λ³΄, κ³µκ°ν‚¤λ¥Ό ν¬ν•¨ν• **CSR (μΈμ¦μ„ μ„λ… μ”μ²­μ„)** λ¥Ό μƒμ„±ν•©λ‹λ‹¤.
3. μƒμ„±ν• CSRμ„ CAμ— μ μ¶ν•©λ‹λ‹¤.

#### π’΅ λΉ„λ°€ν‚¤λ” μ„λ²„κ°€ μƒμ„±ν•κ³  μ™Έλ¶€μ— μ λ€ λ…Έμ¶λμ§€ μ•μ•„μ•Ό ν•©λ‹λ‹¤.

λΉ„λ°€ν‚¤κ°€ μ μ¶λλ©΄
- μ•”νΈν™”λ λ°μ΄ν„°λ¥Ό λ¨λ‘ λ³µνΈν™”ν•  μ μκ² λ¨
- μ„λ²„λ¥Ό κ°€μ¥ν• ν”Όμ‹± μ‚¬μ΄νΈ μƒμ„± κ°€λ¥
- μ¤‘κ°„μ κ³µκ²©(Man-in-the-Middle Attack)μ— μ·¨μ•½ν•΄μ§
- λ¨λ“  HTTPS ν†µμ‹ μ λ³΄μ•μ΄ λ¬΄λ ¥ν™”λ¨

λ”°λΌμ„ λΉ„λ°€ν‚¤λ” λ°λ“μ‹ μ•μ „ν• μ„μΉμ— λ³΄κ΄€ν•κ³ , μ ‘κ·Ό κ¶ν•μ„ μ—„κ²©ν μ ν•ν•΄μ•Ό ν•©λ‹λ‹¤.

---

## 2λ‹¨κ³„ : CAκ°€ μΈμ¦μ„ λ°κΈ‰

1. CAλ” Bobμ΄ μ§„μ§ λ„λ©”μΈ μ†μ μμΈμ§€ μ•„λ λ°©λ²• μ¤‘ ν•λ‚λ¥Ό ν†µν•΄ ν™•μΈν•©λ‹λ‹¤.
   - DNSμ— νΉμ • λ μ½”λ“ λ“±λ΅
   - μ„λ²„μ— νμΌ μ—…λ΅λ“
   - μ΄λ©”μΌ μΈμ¦

2. CAλ” μ„λ²„ μ •λ³΄λ¥Ό κ²€μ¦ν• ν›„ Bobμ κ³µκ°ν‚¤, λ„λ©”μΈ μ •λ³΄, μ ν¨κΈ°κ°„, κΈ°νƒ€ λ©”νƒ€λ°μ΄ν„°λ¥Ό ν•λ‚μ λ¬Έμ„λ΅ λ§λ“­λ‹λ‹¤.

3. CAλ” μ΄ λ¬Έμ„λ¥Ό **CAμ λΉ„λ°€ν‚¤**λ΅ μ•”νΈν™”(μ„λ…)ν•©λ‹λ‹¤.
   - μ΄λ ‡κ² λ§λ“¤μ–΄μ§„ μ„λ…μ΄ ν¬ν•¨λ λ¬Έμ„κ°€ λ°”λ΅ "μΈμ¦μ„"
   - λ”°λΌμ„ CAμ κ³µκ°ν‚¤λ΅λ§ λ³µνΈν™” κ°€λ¥

4. μ„λ²„λ” μ΄ μΈμ¦μ„λ¥Ό μ›Ήμ„λ²„μ— μ„¤μΉν•©λ‹λ‹¤.

#### π’΅ μΈμ¦μ„ μ„λ…μ μλ―Έ
- CAκ°€ λΉ„λ°€ν‚¤λ΅ μ•”νΈν™”ν–λ‹¤λ” κ²ƒμ€ "μ΄ μ„λ²„λ” κ²€μ¦λμ—λ‹¤"λ” CAμ κ³µμ‹ λ³΄μ¦
- λΈλΌμ°μ €λ” λ‚΄μ¥λ CAμ κ³µκ°ν‚¤λ΅ λ³µνΈν™”κ°€ μ„±κ³µν•λ©΄ μ΄ λ³΄μ¦μ„ μ‹ λΆ°

---

## 3λ‹¨κ³„: ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„ μ ‘μ† (Client Hello)

### Aliceκ°€ Bob μ„λ²„μ— HTTPSλ΅ μ ‘μ†

ν΄λΌμ΄μ–ΈνΈλ” λλ¤ λ°μ΄ν„°μ™€ ν΄λΌμ΄μ–ΈνΈκ°€ μ§€μ›ν•λ” μ•”νΈν™” λ°©μ‹λ“¤μ„ μ„λ²„μ— λ³΄λƒ…λ‹λ‹¤:
- Client Random (RA) : λλ¤ μ«μ (μ„Έμ… ν‚¤ μƒμ„±μ©)
- Cipher Suite μμ‹ :
   - `TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256`
   - `TLS_DHE_RSA_WITH_AES_256_CBC_SHA`
   - `TLS_RSA_WITH_AES_128_CBC_SHA`

---

## 4λ‹¨κ³„: μ„λ²„ μ‘λ‹µ (Server Hello)

### μ„λ²„κ°€ ν΄λΌμ΄μ–ΈνΈμ— μ‘λ‹µ

μ„λ²„λ” μ•„λ μ •λ³΄λ“¤μ„ ν΄λΌμ΄μ–ΈνΈμ— μ „λ‹¬ν•©λ‹λ‹¤.
- Server Random (RB) : λλ¤ μ«μ (μ„Έμ… ν‚¤ μƒμ„±μ©)
- ν΄λΌμ΄μ–ΈνΈκ°€ λ³΄λ‚Έ μ•”νΈν™” λ°©μ‹ μ¤‘μ—μ„ ν•λ‚ μ„ νƒ
- μ„λ²„ μΈμ¦μ„ (certificate.crt) μ „λ‹¬

#### π’΅ RA, RBλ¥Ό ν‰λ¬ΈμΌλ΅ μ „μ†΅ν•΄λ„ μ•μ „ν• μ΄μ 
- RA, RB λ‹¨λ…μΌλ΅λ” μ„Έμ… ν‚¤ μƒμ„±μ— μ¶©λ¶„ν•μ§€ μ•μ. S μ™€ ν•¨κ» μ΅°ν•©λμ–΄μ•Όλ§ μλ―Έκ°€ μμ
- λΈλΌμ°μ €λ” λ‚΄μ¥λ CAμ κ³µκ°ν‚¤λ΅ λ³µνΈν™”κ°€ μ„±κ³µν•λ©΄ μ΄ λ³΄μ¦μ„ μ‹ λΆ°

#### π’΅ λ§¤λ² μƒλ΅μ΄ RA, RBλ¥Ό μƒμ„±ν•λ” μ΄μ 
- κ°™μ€ Sκ°’μ΄ μ¬μ‚¬μ©λλ”λΌλ„ λ§¤λ² λ‹¤λ¥Έ μ„Έμ… ν‚¤κ°€ μƒμ„±λμ–΄ μ μΌμ„±μ„ λ³΄μ¥μ¥
- μ΄μ „ μ„Έμ…μ΄ λ…Έμ¶λλ”λΌλ„ λ‹¤λ¥Έ μ„Έμ…μ—λ” μν–¥ μ—†μ

---

## 5λ‹¨κ³„: ν΄λΌμ΄μ–ΈνΈκ°€ μΈμ¦μ„ κ²€μ¦ λ° Pre-Master Secret μƒμ„±

### 1. ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„ μΈμ¦μ„ κ²€μ¦

- λ„λ©”μΈ μ΄λ¦„ μΌμΉ ν™•μΈ
- μ ν¨κΈ°κ°„ ν™•μΈ
- μΈμ¦μ„μ μ„λ…μ΄ μ‹ λΆ°ν•  μ μλ” CAμΈμ§€ ν™•μΈ  
  (λΈλΌμ°μ €μ— λ‚΄μ¥λ Root CA λ©λ΅κ³Ό λΉ„κµ)

#### π’΅ CA μΈμ¦μ„ κ²€μ¦ ν”„λ΅μ„Έμ¤
1. λΈλΌμ°μ €λ” λ‚΄μ¥λ CA λ¦¬μ¤νΈμ—μ„ ν•΄λ‹Ή μΈμ¦μ„ λ°κΈ‰ κΈ°κ΄€μ„ ν™•μΈ
   - CA λ¦¬μ¤νΈμ— μ—†λ‹¤λ©΄ μ‚¬μ©μμ—κ² λ³΄μ• κ²½κ³  λ©”μ‹μ§€ μ¶λ ¥
   - CA λ¦¬μ¤νΈμ— μλ‹¤λ©΄ ν•΄λ‹Ή CAμ κ³µκ°ν‚¤λ΅ μΈμ¦μ„ λ³µνΈν™” μ‹λ„

2. CAμ κ³µκ°ν‚¤λ΅ μΈμ¦μ„κ°€ λ³µνΈν™”λλ‹¤λ©΄
   - ν•΄λ‹Ή μΈμ¦μ„κ°€ μ‹ λΆ°ν•  μ μλ” CAμ— μν•΄ λ°κΈ‰λμ—μμ„ ν™•μΈ
   - μ ‘μ†ν• μ„λΉ„μ¤κ°€ κ³µμΈλ μΈμ¦κΈ°κ΄€μ— μν•΄ λ³΄μ¦λμ—λ‹¤λ” κ²ƒμ„ μλ―Έ

### 2. ν΄λΌμ΄μ–ΈνΈκ°€ Pre-Master Secret μƒμ„±

- λλ¤ λΉ„λ°€κ°’ S μƒμ„±
- μ„λ²„λ΅λ¶€ν„° λ°›μ€ μΈμ¦μ„μ— ν¬ν•¨λ μ„λ²„μ κ³µκ°ν‚¤λ΅ Sλ¥Ό μ•”νΈν™”
- μ•”νΈν™”λ Sλ¥Ό μ„λ²„μ— μ „μ†΅

---

## 6λ‹¨κ³„: μ„λ²„κ°€ Pre-Master Secret λ³µνΈν™” λ° μ„Έμ… ν‚¤ μƒμ„±

1. μ„λ²„λ” μμ‹ μ λΉ„λ°€ν‚¤λ΅ Sλ¥Ό λ³µνΈν™”ν•©λ‹λ‹¤.
   - 1λ‹¨κ³„μ—μ„ μƒμ„±ν•κ³  μ•μ „ν•κ² λ³΄κ΄€ν•΄λ‘” λΉ„λ°€ν‚¤ μ‚¬μ©
   - μ΄ λΉ„λ°€ν‚¤λ” μΈμ¦μ„μ— ν¬ν•¨λ κ³µκ°ν‚¤μ™€ μμ„ μ΄λ£¨λ” ν‚¤
   - μ¤μ§ μ„λ²„λ§μ΄ μ΄ λΉ„λ°€ν‚¤λ¥Ό κ°€μ§€κ³  μμΌλ―€λ΅, μ„λ²„λ§μ΄ Sλ¥Ό λ³µνΈν™”ν•  μ μμ

2. μ–‘μ½ λ¨λ‘κ°€ λ‹¤μμ„ μ΄μ©ν•΄ **μ„Έμ… ν‚¤ K μƒμ„±**
   - `K = h(S, RA, RB)`
   - hλ” ν•΄μ‹ ν•¨μλ¥Ό μλ―Έ
   - S : ν΄λΌμ΄μ–ΈνΈκ°€ μƒμ„±ν• Pre-Master Secret
   - RA : ν΄λΌμ΄μ–ΈνΈκ°€ μƒμ„±ν• λλ¤κ°’ 
   - RB : μ„λ²„κ°€ μƒμ„±ν• λλ¤κ°’

π’΅ μ΄ κ³Όμ •μ μλ―Έ:
- ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„ λ¨λ‘ λ™μΌν• S, RA, RB κ°’μ„ κ°€μ§€κ² λ¨
- λ”°λΌμ„ μ–‘μ½μ—μ„ μƒμ„±ν• μ„Έμ… ν‚¤ Kλ” λ™μΌν• κ°’μ΄ λ¨
- μ΄ν›„μ λ¨λ“  ν†µμ‹ μ€ μ΄ λ€μΉ­ν‚¤ Kλ΅ μ•”νΈν™”/λ³µνΈν™”
- κ³µκ°ν‚¤/λΉ„λ°€ν‚¤ λ°©μ‹λ³΄λ‹¤ ν›¨μ”¬ λΉ λ¥Έ λ€μΉ­ν‚¤ μ•”νΈν™” μ‚¬μ© κ°€λ¥

μ΄ μ„Έμ… ν‚¤ Kλ” μ΄ν›„ λ°μ΄ν„° μ•”νΈν™”μ— μ‚¬μ©λ¨

---

## 7λ‹¨κ³„: ν•Έλ“μ…°μ΄ν¬ μ™„λ£ λ° μ•”νΈν™” ν†µμ‹  μ‹μ‘

### μ„λ΅ ν†µμ‹  μ¤€λΉ„ μ™„λ£

1. ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„λ” `Change Cipher Spec` λ©”μ‹μ§€λ¥Ό κµν™
   - "μ΄μ λ¶€ν„° ν‘μƒλ μ•”νΈν™” λ°©μ‹κ³Ό μ„Έμ… ν‚¤λ¥Ό μ‚¬μ©ν•κ² λ‹¤"λ” μ‹ νΈ
   - μ΄ λ©”μ‹μ§€ μ΄ν›„μ λ¨λ“  ν†µμ‹ μ€ μ„Έμ… ν‚¤(K)λ΅ μ•”νΈν™”λ¨
   - ν•Έλ“μ…°μ΄ν¬ κ³Όμ •μ—μ„ λ§μ§€λ§‰ ν‰λ¬Έ λ©”μ‹μ§€

2. `Finished` λ©”μ‹μ§€λ¥Ό κµν™ β†’ ν•Έλ“μ…°μ΄ν¬ μ„±κ³µ μ—¬λ¶€ μµμΆ… ν™•μΈ
   - μ΄λ―Έ μ•”νΈν™”λ μƒνƒλ΅ μ „μ†΅λλ” μ²« λ©”μ‹μ§€
   - μƒλ€λ°©μ΄ μ„Έμ… ν‚¤λ΅ μ¬λ°”λ¥΄κ² λ³µνΈν™”ν•  μ μλ”μ§€ ν™•μΈ

3. μ΄ν›„ λ¨λ“  λ°μ΄ν„°λ” **μ„Έμ… ν‚¤ Kλ΅ μ•”νΈν™”λμ–΄ μ „μ†΅**

μ΄κ²ƒμΌλ΅ SSL/TLS ν•Έλ“μ…°μ΄ν¬κ°€ μ™„λ£λ©λ‹λ‹¤.

![SSL Connection Protocol](./images/ssl-connection.png)

#### π’΅ μ„Έμ… μ¬μ‚¬μ©

- μ΄λ―Έ ν•Έλ“μ…°μ΄ν¬λ¥Ό ν• μ  μλ” ν΄λΌμ΄μ–ΈνΈλ” **session ID** μ™€ **S** λ¥Ό μ €μ¥ν•κ³  μμ
- μ„λ²„λ„ ν•΄λ‹Ή session IDλ¥Ό κΈ°μ–µν•κ³  μλ‹¤λ©΄ κ³µκ°ν‚¤ μ•”νΈν™” κ³Όμ •μ„ μƒλµν•  μ μμ–΄ λΉ λ¥΄κ³  ν¨μ¨μ μΈ μ¬μ ‘μ†μ΄ κ°€λ¥ν•λ‹¤.

---

## 8λ‹¨κ³„: μ„Έμ… μΆ…λ£ λ° ν‚¤ νκΈ°

### ν†µμ‹  μΆ…λ£ μ μ°¨

1. λ°μ΄ν„° μ „μ†΅μ΄ μ™„λ£λλ©΄ μ–‘μΈ΅μ€ `Close Notify` λ©”μ‹μ§€λ¥Ό κµν™
2. SSL ν†µμ‹ μ΄ μΆ…λ£λμ—μμ„ μ„λ΅μ—κ² μ•λ¦Ό
3. μ‚¬μ©ν–λ μ„Έμ… ν‚¤(K)λ¥Ό μ¦‰μ‹ νκΈ°

#### π’΅ μ„Έμ… ν‚¤ νκΈ°μ μλ―Έ
- μ„Έμ…μ μλ¦½λ¶€ν„° μΆ…λ£κΉμ§€ μ•„μ£Ό μ§§μ€ μ‹κ°„ μ•μ— μ΄λ£¨μ–΄μ§
- μ„¤λ Ή μ•”νΈκ°€ ν•΄λ…λλ”λΌλ„ μ„Έμ… ν‚¤λ” μ΄λ―Έ νκΈ°λ μƒνƒ
- μ΄λ° μ„μ‹μ„±μ΄ SSL/TLS ν†µμ‹ μ λ³΄μ•μ„±μ„ λ”μ± κ°•ν™”

---

#### π’΅ κ³µκ°ν‚¤/λΉ„λ°€ν‚¤ μ•”νΈν™”μ λ‘ κ°€μ§€ μ‚¬μ© λ°©μ‹

1. κΈ°λ°€μ„±(Confidentiality)μ„ μ„ν• μ•”νΈν™”
   - κ³µκ°ν‚¤λ΅ μ•”νΈν™” β†’ λΉ„λ°€ν‚¤λ΅ λ³µνΈν™”
   - μ©λ„: λ°μ΄ν„°λ¥Ό μ•μ „ν•κ² μ „λ‹¬ν•  λ•
   - μμ‹: ν΄λΌμ΄μ–ΈνΈκ°€ pre-master secret(S)μ„ μ„λ²„μ— μ „μ†΅ν•  λ•
   - νΉμ§•: λΉ„λ°€ν‚¤ μ†μ μλ§ λ³µνΈν™” κ°€λ¥

2. μ§„μ •μ„±(Authenticity)μ„ μ„ν• μ „μμ„λ…
   - λΉ„λ°€ν‚¤λ΅ μ•”νΈν™” β†’ κ³µκ°ν‚¤λ΅ λ³µνΈν™”
   - μ©λ„: λ°μ΄ν„°μ μ¶μ²λ¥Ό μ¦λ…ν•  λ•
   - μμ‹: CAκ°€ μΈμ¦μ„μ— μ„λ…ν•  λ•
   - νΉμ§•: λΉ„λ°€ν‚¤ μ†μ μκ°€ μƒμ„±ν• κ²ƒμ„μ„ μ¦λ… κ°€λ¥

μ΄λ ‡κ² μ–‘λ°©ν–¥μΌλ΅ μ‚¬μ© κ°€λ¥ν• νΉμ„± λ•λ¬Έμ— SSL/TLSμ—μ„
- λ°μ΄ν„° μ „μ†΅ μ‹μ—λ” κΈ°λ°€μ„±μ„ μ„ν•΄ κ³µκ°ν‚¤λ΅ μ•”νΈν™”
- μΈμ¦μ„ μ„λ… μ‹μ—λ” μ§„μ •μ„±μ„ μ„ν•΄ λΉ„λ°€ν‚¤λ΅ μ•”νΈν™”

---

#### π’΅SSL/TLSκ°€ λ€μΉ­ν‚¤μ™€ κ³µκ°ν‚¤λ¥Ό μ΅°ν•©ν•΄μ„ μ‚¬μ©ν•λ” μ΄μ 

1. κ³µκ°ν‚¤ μ•”νΈν™”μ ν•κ³„
   - λ†’μ€ μ»΄ν“¨ν… νμ› ν•„μ”
   - λ§μ€ μ ‘μ†μ΄ λ°λ¦¬λ” μ„λ²„μ—μ„λ” ν° λΉ„μ© λ°μƒ
   - μ „μ²΄ ν†µμ‹ μ„ κ³µκ°ν‚¤λ΅ ν•κΈ°μ—λ” λΉ„ν¨μ¨μ 

2. λ€μΉ­ν‚¤ μ•”νΈν™”μ ν•κ³„
   - μ•”νΈν™” ν‚¤λ¥Ό μƒλ€λ°©κ³Ό κ³µμ ν•΄μ•Ό ν•¨
   - μ•”νΈν™”λμ§€ μ•μ€ μΈν„°λ„·μΌλ΅ ν‚¤λ¥Ό μ „μ†΅ν•κΈ°λ” μ„ν—
   - ν‚¤ κµν™ κ³Όμ •μ λ³΄μ•μ΄ μ·¨μ•½

3. λ‘ λ°©μ‹μ μ¥μ μ„ μ΅°ν•©ν• ν•΄κ²°μ±…
   - μ²μμ—λ§ κ³µκ°ν‚¤λ΅ λ€μΉ­ν‚¤(μ„Έμ… ν‚¤)λ¥Ό μ•μ „ν•κ² κµν™
   - μ΄ν›„ μ‹¤μ  λ°μ΄ν„°λ” λΉ λ¥Έ λ€μΉ­ν‚¤λ΅ μ•”νΈν™”
   - λ³΄μ•μ„±κ³Ό μ„±λ¥μ„ λ¨λ‘ ν™•λ³΄
---
